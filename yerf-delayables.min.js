(function(){var f=yerf(),h=!1,g=f.Sample;f.render=function(){if(!h){h=!0;var b=kivi.getConfig("$"),a=yerf().config.waterfallViewer,d;if(a&&a.cssPath)d=a.cssPath;else throw Error("You need to set yerf().config.waterfallViewer.cssPath");if(a&&a.jsPath)a=a.jsPath;else throw Error("You need to set yerf().config.waterfallViewer.jsPath");b("body").append('<link href="'+d+'" rel="stylesheet">');b.getScript(a,function(){yerf().render()})}};g.prototype.backfill=function(b,a,d,e){if("string"!==typeof a)throw Error("You must specify a key for this Sample.");
if("number"!==typeof d)throw Error("You must specify a startedAt for this Sample["+a+"].");if("number"!==typeof e)throw Error("You must specify a stoppedAt for this Sample["+a+"].");if("stopped"!==this.state)return f.onError(Error("Sample["+this.key+"] must be stopped to backfill with key["+a+"].")),this;if(this.children&&this.find(a))return f.onError(Error("Sample["+this.fullChildKey(a)+"] already exists.")),this;var c;this.children=this.children||{};b?this.find(b)?c=this.find(b):(c=new g(this.fullChildKey(b)),
c.startedAt=d,c.stoppedAt=e,c.delta=e-d,c.state="stopped",c.offset=d-this.startedAt,c.children={},c.parent=this,this.children[b]=c):c=this;b=new g(c.fullChildKey(a));b.startedAt=d;b.stoppedAt=e;b.delta=e-d;b.state="stopped";b.offset=d-c.startedAt;0>b.offset&&(b.offset=0);b.parent=c;c.children[a]=b;c.updateBounds(d,e);return this};g.prototype.backfillRequest=function(b,a,d){if(!d)throw Error("You must specify a urlPattern for this Sample.");f.hasEntries&&kivi._.each(f.getEntries(),function(e){var c=
a,f=e.name.match(d);f&&("string"!==typeof c&&(c=f[f.length-1]),this.backfill(b,c,e.startTime,e.startTime+e.duration))},this);return this};g.prototype.normalizedBackfill=function(b,a,d,e){if("number"!==typeof d)throw Error("You must specify a startedAt for this Sample["+a+"].");if("number"!==typeof e)throw Error("You must specify a stoppedAt for this Sample["+a+"].");return this.backfill(b,a,f.normTime(d),f.normTime(e))};g.prototype.updateBounds=function(b,a){var d=this.startedAt-this.offset,e=!1;
b<this.startedAt&&(this.startedAt=b,this.delta=this.stoppedAt-this.startedAt,this.offset=b-d,0>this.offset&&(this.offset=0),kivi._.each(this.children,function(a){a.offset=a.startedAt-b}),e=!0);a>this.stoppedAt&&(this.stoppedAt=a,this.delta=this.stoppedAt-this.startedAt,e=!0);!0===e&&this.parent&&this.parent.updateBounds(b,a);return this}})();
